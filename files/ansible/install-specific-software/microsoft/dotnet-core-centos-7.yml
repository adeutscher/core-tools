---

- hosts: all

  vars:
    distro: "CentOS"
    version: "7"

    packages:
      main:
        - dotnet-runtime-2.1
        - dotnet-sdk-3.1

      other:
        # libunwind is used to run one of my projects.
        # Some Googling suggests that this is not an uncommon requirement, so I am including it here.
        - libunwind

  tasks:

  - name: "fail if not at least {{ distro }} {{ version }}"
    when: ansible_distribution != distro or ansible_distribution < version
    fail: msg="Must only run on {{ distro }} (Minimum version{{ ":" }} {{ version }})"

  - name: "install microsoft repository"
    become: yes
    yum:
      name: https://packages.microsoft.com/config/rhel/7/packages-microsoft-prod.rpm
      state: latest

  - name: "install .net core packages"
    become: yes
    action: >
      {{ ansible_pkg_mgr }} name="{{ packages.main }}" state=latest

  - name: "install other items"
    become: yes
    action: >
      {{ ansible_pkg_mgr }} name="{{ packages.other }}" state=latest


